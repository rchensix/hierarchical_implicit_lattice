%% Commands for TeXCount
%TC:macro \cite [option:text,text]
%TC:macro \citep [option:text,text]
%TC:macro \citet [option:text,text]
%TC:envir table 0 1
%TC:envir table* 0 1
%TC:envir tabular [ignore] word
%TC:envir displaymath 0 word
%TC:envir math 0 word
%TC:envir comment 0 0

\documentclass[acmtog]{acmart}

%% Rights management information.  This information is sent to you
%% when you complete the rights form.  These commands have SAMPLE
%% values in them; it is your responsibility as an author to replace
%% the commands and values with those provided to you when you
%% complete the rights form.
\setcopyright{acmcopyright}
\copyrightyear{2023}
\acmYear{2023}
\acmDOI{XXXXXXX.XXXXXXX}


%%
%% These commands are for a JOURNAL article.
\acmJournal{TOG}
\acmVolume{37}
\acmNumber{4}
\acmArticle{111}
\acmMonth{8}

%%
%% Submission ID.
%% Use this when submitting an article to a sponsored event. You'll
%% receive a unique submission ID from the organizers
%% of the event, and this ID should be used as the parameter to this command.
%%\acmSubmissionID{123-A56-BU3}

%%
%% For managing citations, it is recommended to use bibliography
%% files in BibTeX format.
%%
%% You can then either use BibTeX with the ACM-Reference-Format style,
%% or BibLaTeX with the acmnumeric or acmauthoryear sytles, that include
%% support for advanced citation of software artefact from the
%% biblatex-software package, also separately available on CTAN.
%%
%% Look at the sample-*-biblatex.tex files for templates showcasing
%% the biblatex styles.
%%

%%
%% The majority of ACM publications use numbered citations and
%% references.  The command \citestyle{authoryear} switches to the
%% "author year" style.
%%
%% If you are preparing content for an event
%% sponsored by ACM SIGGRAPH, you must use the "author year" style of
%% citations and references.
\citestyle{acmauthoryear}


%%
%% end of the preamble, start of the body of the document source.
\begin{document}

%%
%% The "title" command has an optional parameter,
%% allowing the author to define a "short title" to be used in page headers.
\title{Symmetric Implicit Surface Microstructures for Hierarchical Design}

%%
%% The "author" command and its associated commands are used to define
%% the authors and their affiliations.
%% Of note is the shared affiliation of the first two authors, and the
%% "authornote" and "authornotemark" commands
%% used to denote shared contribution to the research.
\author{Ruiqi Chen}
\email{rchensix@alumni.stanford.edu}
\orcid{0002-5273-6277}
\author{Hardik Kabaria}
\email{hardik@carbon3d.com}
\author{Saigopal Nelaturi}
\email{snelaturi@carbon3d.com}
\affiliation{
  \institution{Carbon, Inc.}
  \streetaddress{1089 Mills Way}
  \city{Redwood City}
  \state{California}
  \country{USA}
  \postcode{94063}
}

\author{Adrian J. Lew}
\email{lewa@stanford.edu}
\affiliation{
  \institution{Stanford University}
  \streetaddress{440 Escondido Mall}
  \city{Stanford}
  \state{California}
  \country{USA}
  \postcode{94305}
}

%%
%% By default, the full list of authors will be used in the page
%% headers. Often, this list is too long, and will overlap
%% other information printed in the page headers. This command allows
%% the author to define a more concise list
%% of authors' names for this purpose.
\renewcommand{\shortauthors}{Chen et al.}

%%
%% The abstract is a short summary of the work to be presented in the
%% article.
\begin{abstract}
  We present a framework for generating hierarchical structures using a palette of symmetric implicit surface microstructures. The framework utilizes an unstructured mesh composed of either triangles, quadrilaterals, tetrahedrons, or hexahedrons to serve as a scaffold for microstructural unit cells to tile, where each unit cell is represented by an implicit surface and defined using a set of symmetric basis functions derived from Fourier series. Any arbitrary input geometry may be converted into a symmetric implicit surface using an Fast-Fourier-Transform-based method as long as inside/outside queries can be performed on the input geometry. Using our framework, we demonstrate blending together different unit cells to create new ones as well as spatial transitions between different unit cells. In addition, we present a method to constrain unit cells to intersect its bounding polygon/polyhedron at a right angle, which we postulate is necessary for $C^1$ continuity. Finally, we briefly mention some mechanical applications that may benefit from our framework.
\end{abstract}

%%
%% The code below is generated by the tool at http://dl.acm.org/ccs.cfm.
%% Please copy and paste the code instead of the example below.
%%
\begin{CCSXML}
<ccs2012>
    <concept>
        <concept_id>10010405.10010432.10010439.10010440</concept_id>
        <concept_desc>Applied computing~Computer-aided design</concept_desc>
        <concept_significance>500</concept_significance>
        </concept>
    <concept>
        <concept_id>10010405.10010432.10010433</concept_id>
        <concept_desc>Applied computing~Aerospace</concept_desc>
        <concept_significance>100</concept_significance>
        </concept>
    <concept>
        <concept_id>10010147.10010371.10010396</concept_id>
        <concept_desc>Computing methodologies~Shape modeling</concept_desc>
        <concept_significance>500</concept_significance>
        </concept>
  </ccs2012>
\end{CCSXML}

\ccsdesc[500]{Applied computing~Computer-aided design}
\ccsdesc[100]{Applied computing~Aerospace}
\ccsdesc[500]{Computing methodologies~Shape modeling}

%%
%% Keywords. The author(s) should pick words that accurately describe
%% the work being presented. Separate the keywords with commas.
\keywords{hierarchical structure, implicit surface, lattice, microstructure, symmetry}

\received{DD MONTH YYYY}
\received[revised]{DD MONTH YYYY}
\received[accepted]{DD MONTH YYYY}

%%
%% This command processes the author and affiliation and title
%% information and builds the first part of the formatted document.
\maketitle

\section{Introduction}

\subsection{Contributions}

\section{Related Works}

\section{Methodology}

\subsection{Symmetric Implicit Surfaces}
\label{sec:symmetric_implicit_surfaces}

Implicit surfaces represent a geometric object through an equation of the form $\Phi(\mathbf{x}) = 0$ where $\Phi: \mathbb{R}^d \rightarrow \mathbb{R}$ is some function that evaluates a query point $\mathbf{x}$ and returns zero if $\mathbf{x}$ is on the surface, returns a negative value if $\mathbf{x}$ is inside the surface, or returns a positive value if $\mathbf{x}$ is outside the surface (note that this convention is not universal and other authors may use the opposite convention, i.e. points inside the surface have positive return values). The magnitude of the return value may have some geometric meaning, but this is not required. For example, signed distance functions are a subset of implicit surface equations where the magnitude of the return value denotes the distance from the query point $\mathbf{x}$ to the surface.

A symmetric implicit surface is an implicit surface equation that has been constrained such that the geometry that it represents is unchanged after applying any transformation from a chosen symmetry group. In other words, $\Phi(\mathbf{x}) = \Phi(\mathbf{Q} \mathbf{x})$, where $\mathbf{Q}$ is a $d \times d$ orthogonal matrix in the symmetry group that represents a linear transformation of a point $\mathbf{x}$ about the origin. Note that for this work, we are restricting ourselves to linear transformations and excluding affine transformations. We want to constrain the implicit surface to match the symmetry group of the cell type in the unstructured scaffold mesh to tile: dihedral group of degree 3 and order 6 ($D_3$) for triangle meshes, dihedral group of degree 4 and order 8 ($D_4$) for quad meshes, achiral tetrahedral symmetry ($T_d$) for tetrahedron meshes, and achiral octahedral symmetry ($O_h$) for hexahedron meshes. The list of symmetry operators for these four symmetry groups is given in Appendix \ref{sec:symmetry_groups}.

To construct a symmetric implicit surface $\Phi(\mathbf{x})$, we first construct a basis function that is inherently symmetric. A 3D basis function with tetrahedral symmetry $\phi(\mathbf{x}): \mathbb{R}^3 \rightarrow \mathbb{R}$ may be constructed from some other conventional 3D basis function $\psi(\mathbf{x}): \mathbb{R}^3 \rightarrow \mathbb{R}$ by iterating over the symmetry operators $\mathbf{Q} \in T_d$, feeding the transformation $\mathbf{Qx}$ as input to $\psi$, and summing over all 24 possible values of $\mathbf{Q}$:
%
\begin{equation}
  \label{eq:basis_function}
  \phi(\mathbf{x}) = K \sum\limits_{\mathbf{Q} \in T_d} \psi(\mathbf{Qx})
\end{equation}
%
where $K$ is some normalization factor to make the basis function orthonormal. In this work, the 3D Fourier series
%
\begin{equation}
  \label{eq:fourier_series}
  \psi_{\mathbf{f}}(\mathbf{x}) = e^{2\pi i \mathbf{f}^T \mathbf{x}}
\end{equation}
%
is used, where $\mathbf{f} \in \mathcal{T}$ is an integer-valued vector that represents spatial frequencies in the Cartesian directions. The set of all possible parameters is given by $\mathcal{T}$:
%
\begin{equation}
  \mathcal{T} = \left\{ \begin{bmatrix} f_x \\ f_y \\ f_z \end{bmatrix} \in \mathbb{Z}^3 | f_y + f_z \geq 0 \: \text{and} f_y - f_z \geq 0 \: \text{and} f_x - f_y \geq 0 \right\}
\end{equation}
%
Note that the set $\mathcal{T}$ is a subset of $\mathbb{Z}^3$ to avoid duplicate basis functions, i.e. if $\mathcal{T}$ was all of $\mathbb{Z}^3$, then there will be multiple values of $\mathbf{f}$ that result in the same basis function $\phi_{\mathbf{f}}(\mathbf{x})$. Additionally, note that by writing the 3D Fourier series using complex exponentials (as expressed in Equation \ref{eq:fourier_series}), Equation \ref{eq:basis_function} is, in general, a function that takes in real-valued 3D points and returns complex valued scalars, i.e. $\phi_{\mathbf{f}}(\mathbf{x}): \mathbb{R}^3 \rightarrow \mathbb{C}$. However, for the purpose of generating implicit surfaces, only the real or imaginary part (but not both) of the final expression for $\Phi(\mathbf{x})$ will be used.

There are many reasons, both mathematical and practical, as to why the 3D Fourier series is an excellent choice for the foundational basis function, but the primary reasons are: 3D Fourier series are an orthonormal basis, 3D Fourier series have a very simple expression for the gradient (this is used in Section \ref{sec:face_normal_surfaces}); there are fast, robust algorithms available (most notably, the fast Fourier transform) for computing the cofficients of a 3D Fourier expansion; and finally, several famous triply periodic minimal surfaces (TPMS) that are commonly used to construct hierarchical lattice structures (e.g. Schwarz primitive, gyroid) may be approximated using 3D Fourier series \cite{wohlgemuth2001triply}.

Substituting Equation \ref{eq:fourier_series} into Equation \ref{eq:basis_function}, the basis function with tetrahedral symmetry may be expressed as
%
\begin{equation}
  \label{eq:basis_function_actual}
  \phi_{\mathbf{f}}(\mathbf{x}) = K_{\mathbf{f}} \sum\limits_{\mathbf{Q} \in T_d} e^{2 \pi i \mathbf{f}^T \mathbf{Q} \mathbf{x}}
\end{equation}
%
where $K_{\mathbf{f}}$ is the normalization coefficient given by
%
\begin{equation}
  \label{eq:normalization_coeff}
  K_{\mathbf{f}} = \frac{1}{\sqrt{ \iiint_\Omega \left( \sum\limits_{\mathbf{Q_1}, \mathbf{Q_2} \in T_d} e^{2 \pi i \mathbf{f}^T (\mathbf{Q_1 - Q_2}) \mathbf{x}} \right) dV }}
\end{equation}
%
where the region of integration $\Omega$ is the unit cube (with side length of 1) centered at the origin. In the integrand in the denominator of Equation \ref{eq:normalization_coeff}, due to the orthonormal property of 3D Fourier series, only terms where $\mathbf{f}^T (\mathbf{Q_1 - Q_2}) = \mathbf{0}$ contribute to the integral.

Just like the 3D Fourier series, the resulting basis function in Equation \ref{eq:basis_function_actual} is orthonormal, i.e.
%
\begin{equation}
  \begin{split}
    \iiint_{\Omega} \phi_{\mathbf{f}}(\mathbf{x}) \overline{\phi_{\mathbf{g}}(\mathbf{x})} dV = 0 \\
    %
    \iiint_{\Omega} \phi_{\mathbf{f}}(\mathbf{x}) \overline{\phi_{\mathbf{f}}(\mathbf{x})} dV = 1 \\
  \end{split}
\end{equation}
%
for some arbitrary $\mathbf{f} \in \mathcal{T}$, $\mathbf{g} \in \mathcal{T}$, and $\mathbf{f} \neq \mathbf{g}$. However, unlike the 3D Fourier series, Equation \ref{eq:basis_function_actual} also has tetrahedral symmetry. Finally, the implicit surface $\Phi(\mathbf{x})$ may be expressed in terms of the basis functions as
%
\begin{equation}
  \Phi(\mathbf{x}) = \sum\limits_{\mathbf{f} \in \mathcal{T}} c_{\mathbf{f}} \phi_{\mathbf{f}}(\mathbf{x})
\end{equation}
%
where $c_{\mathbf{f}}$ are the weight coefficients for each basis function. As previously mentioned, the return value of $\Phi(\mathbf{x})$ is, in general, complex-valued, so only the real or imaginary part of the result will be used.

Given an arbitrary input implicit surface $g(\mathbf{x}): \mathbb{R}^3 \rightarrow \mathbb{R}$, which may or may not possess tetrahedral symmetry, a tetrahedrally symmetric approximation to $g(\mathbf{x})$ may be computed by projecting $g(\mathbf{x})$ onto the basis functions to recover the weight coefficients:
%
\begin{equation}
  \label{eq:weight_coeffs}
  c_{\mathbf{f}} = \iiint_{\Omega} g(\mathbf{x}) \phi_{\mathbf{f}}(\mathbf{x}) dV
\end{equation}
%
In this case, because the input function $g(\mathbf{x})$ is real-valued, the output function $\Phi(\mathbf{x})$ will also be real-valued. In practice, Equation \ref{eq:weight_coeffs} will be evaluated numerically, and the input geometry to approximate does not have to be an implicit surface, as demonstrated in the following section.

\subsection{Converting Geometry Representations to Implicit Surfaces}

Frequently, a user will choose a unit cell geometry based on some criteria (e.g. aesthetics, porosity, mechanical performance, etc.) to tile to create the hierarchical lattice structure. The input unit cell to tile might not be an implicit surface; furthermore, it might not have tetrahedral symmetry either. To accomodate nearly arbitrary incoming geometry representations (e.g. triangle meshes, NURBS, voxel grids), the only requirement is that the input representation has a method to determine whether a query point is inside or outside the geometry. For example, inside/outside queries on oriented point clouds and triangle meshes/soups can be computed extremely robustly using the fast winding number method \cite{barill2018fast}.

To numerically compute the implicit surface approximation $\Phi(\mathbf{x})$, first, the input geometry should be centered at the origin and be fully contained by the unit tetrahedron described in TODO. The input geometry is then sampled by querying the inside/outside status on an $N \times N \times N$ grid of query points. The query points should equispaced sampled on the domain $[-0.5, 0.5)$, meaning the spacing between adjacement points in the Cartesian directions is $\frac{1}{N}$. Inside points are assigned a scalar value of $-1$ while outside points are assigned a scalar value of $+1$. Next, the fast Fourier transform (FFT) is applied to the inside/outside samples. Finally, the weight coefficients $c_{\mathbf{f}}$ may be computed from the FFT result by noting that the right hand side of Equation \ref{eq:normalization_coeff} is simply a summation of FFT coefficients due to the fact that $\phi_{\mathbf{f}}(\mathbf{x})$ is a summation of 3D complex exponentials.

It is worth noting that if the input geometry is band limited (i.e. the input geometry is generated from a 3D Fourier series implicit equation with a finite set of spatial frequencies), then using the FFT to compute the weight coefficients $c_{\mathbf{f}}$ will be exact up to limitations in floating point computations, as long as $N$ is large enough to satisfy the Nyquist-Shannon sampling theorem, i.e. $h < \frac{N}{2}$ where $h \in \mathbb{Z}$ is the maximum magnitude integer frequency in any Cartesian direction of the input geometry. However, if the input geometry is not band limited (e.g. there are sharp edges and corners), then this method will only yield approximate values of $c_{\mathbf{f}}$ due to aliasing. In practice, given some arbitrary input geometry that may or may not be band limited, one can choose some reasonable starting value for $N$ such that the FFT can compute relatively quickly (for example $N = 2^7$), compute the implicit surface approximation to the input, and use some stopping criteria to determine if $N$ is large enough. One example of stopping criteria is the Hausdorff distance between the input geometry and output approximation. Furthermore, choosing powers of two for values of $N$ is practical due to exploiting efficiencies in the FFT algorithm. The topic of convergence of the Fourier series is well studied in literature. Since the main purpose of this paper is to develop methods to generate hierarchical structures, i.e. the main purpose is \textit{not} about the convergence of 3D Fourier series or the tetrahedrally symmetric basis function, most examples in this paper will use some arbitrarily chosen value for $N$.

The preceding section utilized inside/outside queries of the input geometry to develop the implicit surface approximation. More useful results can be achieved if the signed distance of the input representation can be computed at query points. This enables finding a tetrahedrally symmetric implicit equation approximation to the signed distance function (SDF) of the input geometry. For example, once the SDF approximation is computed, it is trivial to compute dilations and erosions (see Section \ref{sec:dilation_erosion_inversion}). Using the sampled SDF as input will also yield a smoother approximation since the inputs are no longer binary. Because of this, most examples in this paper use the sampled SDF to compute the implicit surface approximation.

\subsection{Face Normal Surfaces}
\label{sec:face_normal_surfaces}

\subsection{Tiling Tetrahedron Mesh Scaffolds}

\subsection{Dilation, Erosion, and Inversion}
\label{sec:dilation_erosion_inversion}

\subsection{Hybridization}

\subsubsection{Weighted Averaging}

\subsubsection{Minkowski Sum and Difference}

\subsection{Spatial Transitions}

\subsection{Generalizing to Other Symmetry Groups}

\section{Discussion}
\subsection{Limitations}
TODO continuity of implicit surface equations, enforcing continuity, etc.

TODO continuity of hybridization and transitions, how to pick transition path to enforce continuity, etc.

\subsection{Future Work}
TODO optimizing weight coefficients to achieve some target, i.e. porosity, stiffness, etc.

\section{Conclusion}

A publically available implementation of this work is available at \url{https://github.com/rchensix/tetrahedral_implicit_lattice} under an MIT License. However, please note that while the implementation itself falls under an MIT License, methods and ideas mentioned in this paper are, at the time of writing, under consideration for a patent \cite{chen2022}.

%%
%% The acknowledgments section is defined using the "acks" environment
%% (and NOT an unnumbered section). This ensures the proper
%% identification of the section in the article metadata, and the
%% consistent spelling of the heading.
\begin{acks}
TODO
\end{acks}

%%
%% The next two lines define the bibliography style to be used, and
%% the bibliography file.
\bibliographystyle{ACM-Reference-Format}
\bibliography{references}

\appendix

\section{Symmetry Groups}
\label{sec:symmetry_groups}
All symmetry operators here are written in crystallographic notation, composed of a $d$-tuple representing the result of applying a linear transformation to a point $\mathbf{x} \in \mathbb{R}^d$. An overbar denotes negation. For example, $x, \overline{z}, y$ represents the linear transformation
\begin{equation}
  \begin{bmatrix}
    1 & 0 & 0 \\
    0 & 0 & -1 \\
    0 & 1 & 0 \\
  \end{bmatrix}
  \begin{bmatrix}
    x \\
    y \\
    z \\
  \end{bmatrix}
  =
  \begin{bmatrix}
    x \\
    -z \\
    y \\
  \end{bmatrix}
\end{equation}


\subsection{Dihedral Group of Degree 3 and Order 6}
The dihedral group of degree 3 and order 6 ($D_3$) is the symmetry group of an equilateral triangle.

\subsection{Dihedral Group of Degree 4 and Order 8}
The dihedral group of degree 4 and order 8 ($D_4$) is the symmetry group of a square.

\subsection{Achiral Tetrahedral Symmetry}
Achiral tetrahedral symmetry ($T_d$) is the symmetry group of a regular tetrahedron.

\subsection{Achiral Octahedral Symmetry}
Achiral tetrahedral symmetry ($O_h$) is the symmetry group of a cube (as well as that of a regular octahedron, hence the name).

\end{document}
\endinput
